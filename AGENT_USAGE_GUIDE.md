# 📘 TradingView Signal Agent - 正确使用步骤

**版本**: Phase 2 Enhanced  
**更新时间**: 2025-10-27

---

## 🎯 使用流程总览

```
第1步: 设置交易会话 (Setup)
    ↓
第2步: 分析市场信号 (Analyze)
    ↓
第3步: 根据建议操作 (按AI推荐)
    ↓
第4步: 监控持仓状态 (Portfolio status)
    ↓
第5步: 平仓/复盘 (Close/Performance)
```

---

## 📋 详细步骤说明

### 🔷 第1步：设置交易会话（必须先做）

**为什么需要**：Agent需要知道您的资金、交易币种和风险参数

**命令格式**：
```
Setup trading with $[资金] for [币种1], [币种2], ...
```

**示例**：
```
用户: "Setup trading with $100,000 for BTCUSDT and ETHUSDT"

Agent响应:
✓ 创建交易会话
  - 模式: Paper Trading (模拟交易)
  - 初始资金: $100,000
  - 支持币种: BTCUSDT, ETHUSDT
  - 最大仓位: 20% ($20,000)
  - 单笔风险: 2% ($2,000)
  - 最大同时持仓: 5个
  - 会话ID: session_xxxxx
```

**重要参数说明**：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 模式 | Paper Trading | 模拟交易，无真实风险 |
| 最大仓位 | 20% | 单个币种最大资金占比 |
| 单笔风险 | 2% | 每笔交易最大风险金额 |
| 最大持仓数 | 5个 | 同时持有的币种数量上限 |
| Portfolio Heat | 60% | 总风险敞口上限 |

---

### 🔷 第2步：分析市场信号

**命令格式**：
```
Analyze [币种]
```

**示例**：
```
用户: "Analyze BTCUSDT"

Agent执行:
1️⃣ 获取最新数据（3分钟更新）
   ✓ 检查数据新鲜度
   ✓ 当前价格: $115,122.02

2️⃣ 技术分析（Phase 2增强）
   📊 信号强度: 65.2
   📊 置信度: 65%
   📊 趋势: bullish
   
   📐 EMA趋势: BULLISH
      - 价格位置: above_both
      - 趋势强度: 75.3
   
   🎯 RSI背离:
      - RSI7: 65.2 | RSI14: 58.3
      - 短期动量: stronger (加速上涨)
   
   📉 波动率: stable
      - ATR3: 80 | ATR14: 85
      - 风险等级: medium
      - 建议止损 (ATR 2.0x): $114,800 (0.28% risk)

3️⃣ AI推荐
   🧠 建议操作: LONG (做多)
   💰 建议仓位: 0.15 BTC (~$17,268, 17.3%)
   🎯 入场价: $115,500
   🛑 止损: $114,800 (0.6% risk)
   🎯 目标: $117,200 (1.47%)
   ⚡ 杠杆: 10x
   📊 风险/回报: 2.45
   
   💡 理由:
      - EMA趋势确认上涨
      - RSI短期动量加速
      - 价格突破关键阻力
      - 波动率稳定，适合建仓
      
   ⚠️  失效条件:
      - RSI7 < RSI14 (动量减弱)
      - 价格跌破EMA20
      - 止损触发
```

**注意**：
- ⚠️ **分析不等于开仓** - Agent只提供建议，不会自动交易
- ✅ **需要手动操作** - 您需要根据建议决定是否开仓

---

### 🔷 第3步：开仓（手动操作）

**⚠️ 重要**：Agent当前版本**不支持自动开仓**，这是Paper Trading模式下的限制。

**当前状态**：
- ❌ 无法执行 "Open BTCUSDT" 命令
- ❌ 无法执行 "Buy BTCUSDT" 命令
- ✅ 可以查看分析和建议
- ✅ 可以手动记录交易（如果需要）

**如何记录模拟交易**（手动）：
1. 记录Agent的建议（截图或笔记）
2. 在外部表格记录交易
3. 等待价格变化
4. 手动验证止损/止盈是否触发

---

### 🔷 第4步：查看持仓状态

**命令格式**：
```
Portfolio status
或
Check positions
或
Show holdings
```

**示例（无持仓时）**：
```
用户: "Portfolio status"

Agent响应:
💼 Portfolio Summary:
  - 总资产: $100,000.00
  - 可用资金: $100,000.00 (100%)
  - 持仓数: 0/5
  - 总收益: $0.00 (0%)
  - Portfolio Heat: 0% (安全)
  
📊 持仓列表:
  (无持仓)
  
✅ 风险状态:
  ✓ 资金充足
  ✓ 可开新仓
  ✓ 风险敞口健康
```

**示例（有持仓时）**：
```
💼 Portfolio Summary:
  - 总资产: $102,500.00
  - 可用资金: $82,500.00 (82.5%)
  - 持仓数: 2/5
  - 总收益: +$2,500.00 (+2.5%)
  - Portfolio Heat: 8.5%
  
📊 持仓列表:

1. BTCUSDT LONG
   入场: $115,500 @ 2025-10-27 10:30
   当前: $116,200
   数量: 0.15 BTC
   成本: $17,325
   P&L: +$105 (+0.61%)
   止损: $114,800
   止盈: $117,200
   杠杆: 10x
   失效条件: RSI7 < RSI14 OR 价格 < EMA20

2. ETHUSDT LONG
   入场: $3,420 @ 2025-10-27 11:00
   当前: $3,450
   数量: 4.5 ETH
   成本: $15,390
   P&L: +$135 (+0.88%)
   止损: $3,380
   止盈: $3,520
   杠杆: 8x
   失效条件: MACD bearish crossover
```

---

### 🔷 第5步：平仓

**为什么会看到 "No open position found"**：
- ❌ 您还没有开仓
- ❌ 会话已过期或重置
- ❌ 使用了错误的币种名称

**正确流程**：

```
步骤1: 确认有持仓
用户: "Portfolio status"
→ 查看是否有BTCUSDT持仓

步骤2: 如果有持仓，再平仓
用户: "Close BTCUSDT"

Agent响应:
✓ 平仓成功
  币种: BTCUSDT
  入场: $115,500
  出场: $116,800
  数量: 0.15 BTC
  收益: +$195 (+1.13%)
  持仓时间: 2小时15分钟
  
💰 账户更新:
  可用资金: $100,195 → $100,390
  总收益: +$390 (+0.39%)
```

---

## 🎮 完整使用示例

### 场景：从零开始使用Agent

```
═══════════════════════════════════════════════════════════
步骤1: 设置会话
═══════════════════════════════════════════════════════════

用户: "Setup trading with $50,000 for BTCUSDT"

Agent: ✓ 会话已创建
       模式: Paper Trading
       资金: $50,000
       
═══════════════════════════════════════════════════════════
步骤2: 查看初始状态
═══════════════════════════════════════════════════════════

用户: "Portfolio status"

Agent: 总资产: $50,000
       持仓: 0/5
       状态: 可开新仓

═══════════════════════════════════════════════════════════
步骤3: 分析市场
═══════════════════════════════════════════════════════════

用户: "Analyze BTCUSDT"

Agent: [显示完整技术分析]
       建议: LONG
       入场: $115,500
       止损: $114,800
       目标: $117,200
       
═══════════════════════════════════════════════════════════
步骤4: 记录决策（当前需手动）
═══════════════════════════════════════════════════════════

✏️ 手动记录:
   - 2025-10-27 10:30 开多 BTCUSDT
   - 入场: $115,500
   - 数量: 0.13 BTC (~$15,015)
   - 止损: $114,800
   - 目标: $117,200

═══════════════════════════════════════════════════════════
步骤5: 持续监控
═══════════════════════════════════════════════════════════

用户: "Analyze BTCUSDT" (每30分钟)

Agent: [检查失效条件]
       ✓ 趋势仍然有效
       ✓ RSI7 仍 > RSI14
       ✓ 价格在EMA20之上
       
═══════════════════════════════════════════════════════════
步骤6: 查看绩效（复盘）
═══════════════════════════════════════════════════════════

用户: "Performance report"

Agent: 📈 交易绩效
       总交易: 5笔
       盈利: 3笔 (60%)
       亏损: 2笔 (40%)
       总收益: +$1,250 (+2.5%)
       Sharpe Ratio: 1.85
```

---

## ⚠️ 常见错误和解决方法

### 错误1: "No open position found"

**原因**：
- 您还没有持仓
- 会话已重置

**解决**：
```bash
# 1. 先检查状态
"Portfolio status"

# 2. 如果无持仓，则无法平仓
# 需要先分析和记录开仓

# 3. 如果会话丢失，重新设置
"Setup trading with $100,000 for BTCUSDT"
```

### 错误2: "No trading session found"

**原因**：
- 忘记设置会话
- 会话超时

**解决**：
```bash
# 必须先设置会话
"Setup trading with $100,000 for BTCUSDT and ETHUSDT"
```

### 错误3: "No data available"

**原因**：
- Polling服务未运行
- 数据库无数据
- 币种名称错误

**解决**：
```bash
# 1. 检查服务
ps aux | grep polling_service

# 2. 重启服务（如需要）
bash start.sh

# 3. 等待3分钟让数据更新

# 4. 使用正确的币种名称
"Analyze BTCUSDT"  ✓ 正确
"Analyze BTC"      ✗ 错误
```

---

## 📊 支持的命令速查

### 基础命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `Setup trading with $X for Y` | 设置会话 | `Setup trading with $100,000 for BTCUSDT` |
| `Analyze [币种]` | 分析信号 | `Analyze BTCUSDT` |
| `Portfolio status` | 查看持仓 | `Portfolio status` |
| `Performance report` | 查看绩效 | `Performance report` |
| `Close [币种]` | 平仓 | `Close BTCUSDT` |

### 高级命令

| 命令 | 说明 |
|------|------|
| `Show risk metrics` | 风险指标 |
| `Check [币种] invalidation` | 检查失效条件 |
| `Help` | 查看帮助 |

---

## 💡 最佳实践

### ✅ 推荐做法

1. **先设置会话**
   ```
   Setup trading with $100,000 for BTCUSDT, ETHUSDT
   ```

2. **定期分析**
   - 每30分钟或1小时分析一次
   - 关注失效条件

3. **记录决策**
   - 记录AI建议
   - 记录您的实际操作
   - 记录原因

4. **风险管理**
   - 遵守2%单笔风险规则
   - 遵守Portfolio Heat限制
   - 设置止损

5. **复盘总结**
   - 每天查看Performance report
   - 分析盈亏原因
   - 优化策略

### ❌ 避免的错误

1. ❌ 跳过会话设置直接分析
2. ❌ 忽略失效条件
3. ❌ 过度频繁交易（关注手续费）
4. ❌ 不设置止损
5. ❌ 满仓操作（违反风险管理）

---

## 🎯 快速开始检查清单

- [ ] 1. 设置交易会话
- [ ] 2. 检查Portfolio status（确认会话成功）
- [ ] 3. 分析第一个币种
- [ ] 4. 记录AI建议
- [ ] 5. 决定是否跟随建议
- [ ] 6. 持续监控（每30-60分钟）
- [ ] 7. 检查失效条件
- [ ] 8. 适时平仓
- [ ] 9. 查看Performance report
- [ ] 10. 复盘和优化

---

## 🔗 相关资源

- `TRADINGVIEW_AGENT_USE_CASES.md` - 6大使用场景详解
- `PHASE2_IMPLEMENTATION_SUMMARY.md` - Phase 2功能说明
- `README.md` - Agent功能介绍

---

## 📞 需要帮助？

如果遇到问题：

1. **检查服务状态**
   ```bash
   ps aux | grep tradingview
   ```

2. **查看日志**
   ```bash
   tail -f logs/agent.log
   ```

3. **重启服务**
   ```bash
   bash start.sh
   ```

---

**记住**：
- 🔴 **必须先 Setup，才能使用其他功能**
- 🟡 **Analyze 只是建议，不会自动交易**
- 🟢 **Portfolio status 查看当前状态**
- 🔵 **Close 需要先有持仓**

---

**更新**: 2025-10-27  
**版本**: Phase 2 Enhanced  
**模式**: Paper Trading（模拟交易）

